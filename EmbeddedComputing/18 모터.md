18 모터
===

# 1. 모터의 종류

- DC (Direct Current) 모터

    - 최초로 만들어진 모터
    - 연속 회전 모터
    - 정지 시 관성으로 정확한 위치 제어 어려움

- 스테핑 (stepping) 모터

    - 분할 각도(step angle) 단위로만 회전

    - 분할 각도 단위 회전을 위해 펄스 사용

    - 분할 각도 크기 조절을 위한 다양한 방법이 사용됨

- 서보 (servo) 모터

    - DC 모터에 귀환 제어 회로 추가

    - 정확한 위치 제어가 가능

    - 일반적으로 0~180도 범위에서만 회전

# 2. DC 모터 제어

## 2.1 DC 모터의 특징

- 2개의 전원 연결선만을 가짐
- 전원 연결의 방향에 따라 정회전/역회전 결정
- PWM 신호를 사용하여 속도 제어 가능

## 2.2 문제점

- 모터는 많은 전력을 필요로 하므로 디지털 출력 핀으로는 제어 어려움

    - 모터 전용 전원 필요
    - 모터 전용 전원 제어를 위한 스위치(트랜지스터) 사용

- 전원 연결 방향을 바꾸는 방법 필요

    - 모터 드라이버라 불리는 모터 제어 전용 칩 사용

## 2.3 H브릿지 회로

앞서 DC 모터는 전원 연결의 방향에 따라 정회전과 역회전이 가능하다고 했습니다. 이를 H브릿지 회로를 이용하여 선택을 할 수 있습니다.

- 전원 인가 방향 제어 회로
- S1 & S4 스위치를 누를 때와 S2 & S3 스위치를 누를 때 모터에 가해지는 전압이 반대가 됨

![alt](img/H브릿지%20회로.png)

# 3. 서보 모터

![alt](img/서보모터.jpg)

- 3개의 연결선 : 전원 2개(VCC, GND), 제어선 1개

    - VCC : 붉은색
    - GND : 검정색 또는 갈색
    - 제어선 : 노란색, 주황색 또는 흰색
        - 회전 위치/속도 제어에 사용
        - 디지털 핀의 출력으로 제어 가능 : DC 모터의 경우 별도의 별도의 제어선 없이 전원에 의해 제어

## 3.1 종류

- 표준 서보 모터 : 0~180도 범위 회전
- 연속 회전 서보 모터 : 360도 회전 가능

## 3.2 PWM 신호

서보모터는 50Hz(20ms)의 PWM 신호로 제어 됩니다. 16비트 타이머 카운터를 이용하며, 듀티 사이클을 5~10%(1ms)를 준다면 0도를 가르키게 됩니다. 

8비트 타이머 카운터로는 해상도 부족으로 정밀 제어가 어렵습니다.

![alt](img/PMW%20신호.png)

## 3.3 회로도

![alt](img/서보모터%20회로도.png)

## 3.4 코드

```c++
#define F_CPU 16000000L
#include <avr/io.h>
#include <util/delay.h>

#define ROTATION_DELAY 	1500	// 1초 대기
#define PULSE_MIN		(40000*0.0325)	// 최소 펄스 길이
#define PULSE_MID		3000
#define PULSE_MAX		(40000*0.1175)	// 최대 펄스 길이

void INIT_TIMER1(void)
{
	// Fast PWM 모드, TOP = ICR1
	TCCR1A |= (1 << WGM11);
	TCCR1B |= (1 << WGM12) | (1 << WGM13);
	
	TCCR1B |= (1 << CS11);		// 분주율 8, 2MHz
	
	ICR1 = 40000;				// 20ms 주기
	
	TCCR1A |= (1 << COM1A1);		// 비반전 모드
	
	//  OC1A (PB1, 아두이노 9번) 핀을 출력으로 설정
	DDRB |= (1 << PB1);
}

int main(void)
{
	INIT_TIMER1();
	
	while(1)
	{
		OCR1A = PULSE_MIN;		// 0도
		_delay_ms(ROTATION_DELAY);
		
		OCR1A = PULSE_MID;		// 90도
		_delay_ms(ROTATION_DELAY);
		
		OCR1A = PULSE_MAX;		// 180도
		_delay_ms(ROTATION_DELAY);
	}
}
```

![alt](img/서보모터%20타이머%20설정.png)

