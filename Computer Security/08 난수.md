08 난수
===

앞서 배운 암호화 방식들은 난수를 생성하여 키를 만듭니다. 

- 대칭키 생성 : 대칭 암호나 메시지 인증 코드에서 사용
- 공개 키 쌍의 생성 : 공개 키 암호나 디지털 서명에서 사용
- 초기화 벡터(IV)의 생성 : 블록 암호 모드인 CBC, CFB, OFB에서 각각 사용
- 난스(nonce)의 생성 : 재전송 공격 방지나 블록 암호의 CTR 모드 등에서 사용
- 솔트의 생성 : 패스워드를 기초로 한 암호화(PBE)등에서 사용

난수는 예측 불가능성을 이용하여 간파 당하지 않기 위해 사용합니다. 난수는 다음과 같은 성질이 있습니다.

- 무작위성 : 통계적인 편중이 없이 엉터리 수열로 되어 있는 성질
- 예측 불가능성 : 과거의 수열로 부터 다음 수를 예측할 수 없다는 성질
- 재현 불가능성 : 같은 수열을 재현할 수 없다는 성질. 재현하기 위해서는 수열 그 자체를 보존해 두는 수밖에 없다.

> 난수의 성질은 무작위성 $\in$ 예측 불가능성 $\in$ 재현 불가능성

# 2. 난수의 분류


| 종류          | 무작위성 | 예측불가능성 | 재현불가능성 | 특징                    | 비고                       |
| ------------- | -------- | ------------ | ------------ | ----------------------- | -------------------------- |
| 약한 의사난수 | ○        | X            | X            | 무작위성만 갖는다       | 암호기술에 사용할 수 없다. |
| 강한 의사난수 | ○        | ○            | X            | 예측 불가능성도 갖는다. | 암호기술에 사용할 수 있다. |
| 진정한 난수   | ○        | ○            | ○            | 재현 불가능성도 갖는다. | 암호기술에 사용할 수 있다. |

소프트웨어만으로는 재현 불가능성을 갖는 난수열을 만들 수 없습니다. 소프트웨어가 생성하는 수열은 언젠가는 반복되기 때문입니다. 다양한 하드웨어로 부터 얻어진 정보를 기초로 생성한 수열은 재현 불가능성을 갖는 난수열이 됩니다.

## 2.1 의사난수 생성기

하드웨어로 난수를 생성할 경우, 열이나 음의 변화등의 예측이나 재현이 사실상 불가능한 자연 현상을 센서로 감지해서 그 결과를 기초로 난수열을 생성합니다. 이런 하드웨어를 **난수 생성기**(RNG. Random Number Generator)라 부릅니다.

> 소프트웨어만으로는 진정한 난수를 생성할 수 없으므로 '의사' 난수 생성기라 부릅니다.

의사난수 생성기를 다음 절차로 난수를 생성합니다.

1. 내부 상태(카운터)를 초기화
2. 키를 사용해서 카운터를 암호화
3. 그 암호문을 의사난수로서 출력
4. 카운터를 1 증가
5. 원하는 의사난수열의 갯수 만큼 2 ~ 4의 과정을 반복

### 구조

의사난수 생성기는 '내부 상태'를 가지며, 외부에서 주어진 시드(Seed)를 기초로 의사난수열을 생성합니다.

![alt](image/08%20의사난수%20생성기%20구조.png)

### 내부 상태

내부 상태는 의사난수 생성기가 관리하고 있는 메모리 값이다. 의사난수 생성기는 메모리의 값(내부상태)을 기초로 해서 계산을 수행하고, 그 계산 결과를 의사난수로서 출력합니다. 그리고 다음 의사난수의 요구에 대비하여 자신의 내부 상태를 변화시킵니다.

### 시드

의사난수 생성기로 의사난수를 생성하기 위해서는 의사난수의 종자(seed)라 불리는 정보가 필요합니다. 의사난수의 종자는 의사난수 생성기의 내부 상태를 초기화하기 위해 이용합니다. 의사난수의 「종자」는 랜덤한 비트 열이며, 「종자」에 의해 자신만이 사용할 의사난수열을 생성할 수 있습니다. 의사난수 생성기는 모두가 공유하지만, 「종자」는 자신만의 비밀로 해야 합니다.

### 종류

- 엉터리 방법
- 선형합동법
- 일방향 해시함수를 사용하는 방법
- 암호를 사용하는 방법
- ANSI X9.17

### 엉터리 방법

복잡하게 만든 알고리즘을 사용해서 수의 열을 생성시키면, 대부분의 경우 짧은 주기를 가집니다. 암호 기술에서 난수는 예측 불가능해야 하므로 주기가 짧아서는 안됩니다.

### 선형합동법

가장 많이 사용되는 의사난수 생성기로 무작위성을 갖는 의사난수열을 간단히 생성할 수 있습니다. 하지만 이역시 예측 불가능성이 없으므로 암호 기술에 사용할 수 없습니다.

### 구조

![alt](image/08%20선형합동법%20구조.png)

### 일방향 해시함수를 사용하는 방법

일방향 해시 함수(예를 들면 SHA-1)를 사용해서 예측 불가능성을 갖는 의사난수 열(강한 의사난수)을 생성하는 의사난수 생성기를 만들 수 있습니다.

![alt](image/08%20일방향%20해시함수를%20이용한%20의사난수%20생성기%20구조.png)

### 암호를 사용하는 방법

암호를 사용해서 「강한 의사난수」를 생성하는 의사난수 생성기를 만들 수 있습니다. AES와 같은 대칭 암호나 RSA와 같은 공개 키 암호 중 어느 것을 사용해도 상관없음 

### ANSI X9.17

![alt](image/08%20ANSI%20X9.17%20구조.png)

1. 내부 상태를 초기화한다. 
1. 현재 시각을 암호화해서 「뒤섞기 역」을 만든다. 
1. 내부 상태와 뒤섞기 역의 XOR을 취한다. 
1. 절차(3)의 결과를 암호화한다. 
1. 절차(4)의 결과를 의사난수로서 출력한다. 
1. 절차(4)의 출력과 뒤섞기 역의 XOR을 취한다. 
1. 절차(6)의 결과를 암호화한다. 
1. 절차(7)의 결과를 새로운 내부 상태로 한다. 
1. 절차(2)~(8)을 필요한 만큼의 의사난수가 얻어질 때까지 반복한다.
